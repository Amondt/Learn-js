<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>Piou-Piou | 2d shooter</title>
    <link rel="stylesheet" href="../css/style.css">
    <link href="https://fonts.googleapis.com/css?family=Raleway:400,700" rel="stylesheet">
    <style>
        * {
            text-align: center;
            font-family: 'Raleway', sans-serif;
            font-weight: 700;
        }
        h1 {
            font-size: 50px;
        }
    </style>
</head>
<body onload='startMenu()'>
    <div id="menu" width="1000" height="600">
        <h1>Robot Shooter 2d | Piou-Piou</h1>
        <button id='start'>Start</button>
    </div>
    <script>
        // Robot image
        var robotImg = new Image(387, 512);
        robotImg.src = '../img/robotic.svg';
        // Alien image
        var alienImg = new Image(437, 512);
        alienImg.src = '../img/monster.svg';
        // Star shoot image
        var shootImg = new Image(243, 688);
        shootImg.src = '../img/shooting-star.svg';

        var robot, alien, shoot;

        function startMenu() {
            document.querySelector('#start').addEventListener('click', () => {
                document.querySelector('#menu').style.display = 'none';
                startGame();
            })
        }
        
        function startGame() {
            robot = new component(robotImg, 70, 70*(robotImg.height/robotImg.width), 465, 500);
            alien = new component(alienImg, 70, 70*(alienImg.height/alienImg.width), Math.floor((Math.random()*930)+1), Math.floor((Math.random() * 250)+1));
            shoot = new component(shootImg, 20, 20*(shootImg.height/shootImg.width), (robot.x+25), 600);
            shoot2 = new component(shootImg, 20, 20*(shootImg.height/shootImg.width), (robot.x+25), 600);
            gameArea.start();
        }
        var gameArea = {
            canvas : document.createElement('canvas'),
            start : function() {
                this.count = 1;
                this.canvas.width = 1000;
                this.canvas.height = 600;
                this.context = this.canvas.getContext('2d');
                this.canvas.id = 'game';
                document.body.insertBefore(this.canvas, document.body.childNodes[1]);
                this.interval = setInterval(updateGameArea, 20);
                gameArea.keys = (gameArea.keys || []);
                window.addEventListener('keydown', function(e) {
                    gameArea.keys[e.keyCode] = true;
                })
                window.addEventListener('keyup', function(e) {
                    gameArea.keys[e.keyCode] = false;
                })
                window.addEventListener('keypress', function(e) {
                    gameArea.shootPress = true;
                })
            },
            clear : function() {
                this.context.clearRect(0, 0, this.canvas.width, this.canvas.height);
            },
            stop : function() {
                clearInterval(this.interval);
            },
            winDisplay : function() {
                this.context.font = "200px Raleway";
                this.context.fillStyle = "#fefefe";
                this.context.textAlign = 'center';
                this.context.fillText("You Win", this.canvas.width/2, this.canvas.height/2+50);
            }
        }
        function component(img, width, height, x, y) {
            this.img = img;
            this.width = width;
            this.height = height;
            this.x = x;
            this.y = y;
            this.speedX = 0;
            this.speedY = 0;
            this.update = function() {
                ctx = gameArea.context;
                ctx.drawImage(this.img, this.x, this.y, this.width, this.height);
            }
            this.newPos = function() {
                this.x += this.speedX;
                this.y += this.speedY;
            }
            this.stopMove = function() {
                this.speedX = 0;
                this.speedY = 0;
            }
            this.crashWith = function(otherObj) {
                var left = this.x;
                var right = this.x + (this.width);
                var top = this.y;
                var bot = this.y + (this.height);
                var otherLeft = otherObj.x;
                var otherRight = otherObj.x + (otherObj.width);
                var otherTop = otherObj.y;
                var otherBot = otherObj.y + (otherObj.height);
                var crash = true;
                if ((bot < otherTop) || (top > otherBot) || (right < otherLeft) || (left > otherRight)) {
                    crash = false;
                }
                return crash;
            }
            this.shootStar = function() {
                if (shoot.y < 50) {
                    shoot = new component(shootImg, 20, 20*(shootImg.height/shootImg.width), (robot.x+25), (robot.y-20));
                    shoot.speedY = -15;
                } else if (shoot.y == 600) {
                    shoot = new component(shootImg, 20, 20*(shootImg.height/shootImg.width), (robot.x+25), (robot.y-20));
                    shoot.speedY = -15;
                }
            }
            this.shootStar2 = function() {
                if (shoot2.y < 50) {
                    shoot2 = new component(shootImg, 20, 20*(shootImg.height/shootImg.width), (robot.x+25), (robot.y-20));
                    shoot2.speedY = -15;
                } else if (shoot2.y == 600) {
                    shoot2 = new component(shootImg, 20, 20*(shootImg.height/shootImg.width), (robot.x+25), (robot.y-20));
                    shoot2.speedY = -15;
                }
            }
            this.resetShoot = function() {
                this.speedY = 0;
                this.y = 600;
            }
        }
        function updateGameArea() {
            gameArea.clear();
            robot.stopMove();
            // robot movement events
            if (gameArea.keys && gameArea.keys[37]) {robot.speedX = -10;}
            if (gameArea.keys && gameArea.keys[39]) {robot.speedX = 10;}
            // shoot event
            if (gameArea.shootPress && gameArea.shootPress == true) {
                if (shoot.y < 300) {
                    robot.shootStar2();
                } else {
                    robot.shootStar();
                }
                gameArea.shootPress = false;
            }
            // stop shoot after screen and reset it down
            if (shoot.y < -100) {
                shoot.resetShoot();
            }
            if (shoot2.y < -100) {
                shoot2.resetShoot();
            }
            // check if shoot crash with alien
            if (shoot.crashWith(alien) || shoot2.crashWith(alien)) {
                shoot.resetShoot();
                shoot2.resetShoot();
                gameArea.count -= 1;
                alien = new component(alienImg, 70, 70*(alienImg.height/alienImg.width), Math.floor((Math.random() * 530)), Math.floor((Math.random() * 250)));
                console.log(gameArea.count);
                console.log(alien.x, alien.y);
            }
            robot.newPos();
            robot.update();
            alien.newPos();
            alien.update();
            shoot.newPos();
            shoot.update();
            shoot2.newPos();
            shoot2.update();
            if (gameArea.count == 0) {
                gameArea.stop();
                gameArea.clear();
                gameArea.winDisplay();
            }
        }
    </script>
</body>
</html>